plan_id,row_type,change_id,step_id,phase,commit_order,step_order,commit_message,title,spec_refs,doc_refs,instructions,test_methodology,expected_output,dependencies,status,notes
2026-01-06_23-44-40-flowchart-shape-support,CHANGE,shape-master-inventory,,1,1,,,盘点当前 shape 名与 Visio master 的映射关系，确认目标形状的映射与旋转策略。,md2visio/vsdx/@base/VShapeDrawer.cs:54,plan/2026-01-06_23-44-40-flowchart-shape-support.md;design/2026-01-06_23-44-40-flowchart-shape-support/shape-master-inventory.md,"盘点当前 shape 名与 Visio master 的映射关系，确认目标形状的映射与旋转策略。 范围：in: md2visio.vssx, md2visio/struc/graph/GNodeShape.cs; out: 具体代码改动。验收：记录 tri/h-cyl/text/card/diam/hex/cyl 的最终 master/变换方案。",Open the stencil and list masters (Visio UI or a small inspection script).\nCross-check against mapping table entries.,Each target shape has a confirmed master name and rendering strategy.,,Completed,"done_at:2026-01-07; tests:pwsh Add-Type -AssemblyName System.IO.Compression.FileSystem; $zip=[IO.Compression.ZipFile]::OpenRead('md2visio.vssx'); $entry=$zip.Entries|?{$_.FullName -eq 'visio/masters/masters.xml'}|select -First 1; $r=[IO.StreamReader]::new($entry.Open()); [xml]$x=$r.ReadToEnd(); $r.Close(); $zip.Dispose(); $m=$x.Masters.Master|%{$_.Name}; 'Triangle','Database','Single Snip Corner Rectangle','[]','{}','{{}}','[()]'|%{ ""$_: "" + ($m -contains $_) }; evidence: Triangle/Database/Single Snip Corner Rectangle/[]/{} /{{}}/[()] present; mapping table added"
2026-01-06_23-44-40-flowchart-shape-support,STEP,shape-master-inventory,shape-master-inventory.01,1,1,1,,"md2visio.vssx - Enumerate master names in the stencil and confirm candidate masters such as Triangle, Database, Single Snip Corner Rectangle, and bracket masters like [], {}, {{}}, [()].",,design/2026-01-06_23-44-40-flowchart-shape-support/shape-master-inventory.md,"Enumerate master names in the stencil and confirm candidate masters such as Triangle, Database, Single Snip Corner Rectangle, and bracket masters like [], {}, {{}}, [()].\nDONE_CHECK: Master list captured and candidate presence recorded.",,,,Completed,
2026-01-06_23-44-40-flowchart-shape-support,STEP,shape-master-inventory,shape-master-inventory.02,1,1,2,,"design/2026-01-06_23-44-40-flowchart-shape-support/shape-master-inventory.md - Record the chosen mapping table for tri/h-cyl/text/card/diam/hex/cyl, including any rotation or postprocess notes.",,design/2026-01-06_23-44-40-flowchart-shape-support/shape-master-inventory.md,"Record the chosen mapping table for tri/h-cyl/text/card/diam/hex/cyl, including any rotation or postprocess notes.\nDONE_CHECK: Mapping table exists and covers all target shapes.",,,,Completed,
2026-01-06_23-44-40-flowchart-shape-support,CHANGE,graph-shape-aliases,,2,2,,,扩展 GNodeShape 形状别名与映射，保证新 shape 名不会触发 unknown shape error。,md2visio/struc/graph/GNodeShape.cs:85,plan/2026-01-06_23-44-40-flowchart-shape-support.md;design/2026-01-06_23-44-40-flowchart-shape-support/graph-shape-aliases.md,扩展 GNodeShape 形状别名与映射，保证新 shape 名不会触发 unknown shape error。 范围：in: md2visio/struc/graph/GNodeShape.cs; out: 解析器/渲染器改动。验收：tri/diam/text/card/h-cyl 均能产出合法 ShapeStart/ShapeClose。,"Parse a file containing @{ shape: tri }, @{ shape: diam }, @{ shape: text }, @{ shape: card }, @{ shape: h-cyl }.\nConfirm no ""unknown shape name"" error is logged.",New shape names resolve to Start/Close tokens and parsing proceeds.,,Completed,"done_at:2026-01-07; tests:dotnet build D:\GitHub_repository\md2visio\md2visio\md2visio.csproj -c Debug; pwsh $dll = ""D:\GitHub_repository\md2visio\md2visio\bin\Debug\net8.0\md2visio.dll""; $asm=[Reflection.Assembly]::LoadFrom($dll); $type=$asm.GetType(""md2visio.struc.graph.GNodeShape""); $startMethod=$type.GetMethod(""ShapeStart"",[Reflection.BindingFlags]""Public,Static""); $closeMethod=$type.GetMethod(""ShapeClose"",[Reflection.BindingFlags]""Public,Static""); (""tri"",""diam"",""text"",""card"",""h-cyl"")|%{ $s=[string]$_; $start=$startMethod.Invoke($null,[object[]]@($s)); $close=$closeMethod.Invoke($null,[object[]]@($s)); ""$s => $start$close"" }; evidence: tri=>Triangle, diam=>{}, text=>[], card=>Single Snip Corner Rectangle, h-cyl=>[()]"
2026-01-06_23-44-40-flowchart-shape-support,STEP,graph-shape-aliases,graph-shape-aliases.01,2,2,1,,"md2visio/struc/graph/GNodeShape.cs:85 - Add ShapeStart cases for diam, text, h-cyl, tri, card using the mapping from shape-master-inventory (diam -> {, text -> [, h-cyl -> [(, tri/card -> master-name token if chosen).",,design/2026-01-06_23-44-40-flowchart-shape-support/graph-shape-aliases.md,"Add ShapeStart cases for diam, text, h-cyl, tri, card using the mapping from shape-master-inventory (diam -> {, text -> [, h-cyl -> [(, tri/card -> master-name token if chosen).\nDONE_CHECK: ShapeStart returns without throwing for all new names.",,,,Completed,
2026-01-06_23-44-40-flowchart-shape-support,STEP,graph-shape-aliases,graph-shape-aliases.02,2,2,2,,"md2visio/struc/graph/GNodeShape.cs:108 - Add ShapeClose cases for the same names (diam -> }, text -> ], h-cyl -> )], tri/card -> empty string if using master-name token).",,design/2026-01-06_23-44-40-flowchart-shape-support/graph-shape-aliases.md,"Add ShapeClose cases for the same names (diam -> }, text -> ], h-cyl -> )], tri/card -> empty string if using master-name token).\nDONE_CHECK: ShapeClose returns without throwing for all new names.",,,,Completed,
2026-01-06_23-44-40-flowchart-shape-support,STEP,graph-shape-aliases,graph-shape-aliases.03,2,2,3,,md2visio/struc/graph/GNodeShape.cs:65 - Review ShapeName and fragment regex for bracket syntax to ensure no behavioral change; do not add non-bracket tokens there.,,design/2026-01-06_23-44-40-flowchart-shape-support/graph-shape-aliases.md,Review ShapeName and fragment regex for bracket syntax to ensure no behavioral change; do not add non-bracket tokens there.\nDONE_CHECK: Bracket syntax parsing remains unchanged.,,,,Completed,
2026-01-06_23-44-40-flowchart-shape-support,CHANGE,vdrawer-graph-shape-postprocess,,3,3,,,在 VDrawerG 添加形状后处理：text 去边框/填充，h-cyl 旋转并保持文本水平。,md2visio/vsdx/VDrawerG.cs:103,plan/2026-01-06_23-44-40-flowchart-shape-support.md;design/2026-01-06_23-44-40-flowchart-shape-support/vdrawer-graph-shape-postprocess.md,在 VDrawerG 添加形状后处理：text 去边框/填充，h-cyl 旋转并保持文本水平。 范围：in: md2visio/vsdx/VDrawerG.cs; out: 其他图表渲染。验收：text 节点无边框/填充，h-cyl 外观为水平圆柱且文字水平。,Convert a sample file containing text and h-cyl nodes.\nInspect Visio output for fill/line removal and rotation.,text nodes are transparent with only labels.\nh-cyl nodes appear horizontal with horizontal text.,,Completed,done_at:2026-01-07; tests:dotnet run --project %TEMP%\md2visio_test_runner\Md2VisioTestRunner\Md2VisioTestRunner.csproj -- %TEMP%\md2visio_shape_postprocess_test.md D:\GitHub_repository\md2visio\output; evidence: output/md2visio_shape_postprocess_test1.vsdx generated
2026-01-06_23-44-40-flowchart-shape-support,STEP,vdrawer-graph-shape-postprocess,vdrawer-graph-shape-postprocess.01,3,3,1,,"md2visio/vsdx/VDrawerG.cs:368 - Add a helper (e.g., PostProcessShape) and call it after CreateShape (and after AdjustSize).",,design/2026-01-06_23-44-40-flowchart-shape-support/vdrawer-graph-shape-postprocess.md,"Add a helper (e.g., PostProcessShape) and call it after CreateShape (and after AdjustSize).\nDONE_CHECK: Postprocess hook runs for each created node.",,,,Completed,
2026-01-06_23-44-40-flowchart-shape-support,STEP,vdrawer-graph-shape-postprocess,vdrawer-graph-shape-postprocess.02,3,3,2,,"md2visio/vsdx/VDrawerG.cs:103 - For shape name ""text"", set LinePattern and FillPattern to 0 (match DropText behavior). Ensure the call happens after default styles are applied so patterns remain off.",,design/2026-01-06_23-44-40-flowchart-shape-support/vdrawer-graph-shape-postprocess.md,"For shape name ""text"", set LinePattern and FillPattern to 0 (match DropText behavior). Ensure the call happens after default styles are applied so patterns remain off.\nDONE_CHECK: Text nodes render without border/fill.",,,,Completed,
2026-01-06_23-44-40-flowchart-shape-support,STEP,vdrawer-graph-shape-postprocess,vdrawer-graph-shape-postprocess.03,3,3,3,,"md2visio/vsdx/VDrawerG.cs:368 - For shape name ""h-cyl"", rotate the shape 90 degrees (Rotate or Angle cell) and reset text angle to keep text horizontal.",,design/2026-01-06_23-44-40-flowchart-shape-support/vdrawer-graph-shape-postprocess.md,"For shape name ""h-cyl"", rotate the shape 90 degrees (Rotate or Angle cell) and reset text angle to keep text horizontal.\nDONE_CHECK: Horizontal cylinder renders correctly and text is readable.",,,,Completed,
2026-01-06_23-44-40-flowchart-shape-support,CHANGE,flowchart-shape-samples,,4,4,,,增加或准备覆盖样例（含 @{ shape: tri/text/rounded/diam/hex/cyl/h-cyl/lean-l/lean-r/trap-b/trap-t/card }）。,md2visio/mermaid/graph/GSttExtendShape.cs:7,plan/2026-01-06_23-44-40-flowchart-shape-support.md;design/2026-01-06_23-44-40-flowchart-shape-support/flowchart-shape-samples.md,增加或准备覆盖样例（含 @{ shape: tri/text/rounded/diam/hex/cyl/h-cyl/lean-l/lean-r/trap-b/trap-t/card }）。 范围：in: md2visio/test 或用户样例; out: 生产代码。验收：解析无异常，debug.txt 不再出现 unknown shape。,Convert the sample and check debug.txt for parsing errors.,"No ""unknown shape name"" or syntax errors during parsing.",,Not Started,
2026-01-06_23-44-40-flowchart-shape-support,STEP,flowchart-shape-samples,flowchart-shape-samples.01,4,4,1,,test.md - Decide whether to update test.md or md2visio/test/graph.md as the canonical sample.,,design/2026-01-06_23-44-40-flowchart-shape-support/flowchart-shape-samples.md,Decide whether to update test.md or md2visio/test/graph.md as the canonical sample.\nDONE_CHECK: Sample location confirmed.,,,,Not Started,
2026-01-06_23-44-40-flowchart-shape-support,STEP,flowchart-shape-samples,flowchart-shape-samples.02,4,4,2,,"test.md - Add a mermaid flowchart block with nodes using @{ shape: rect/text/rounded/tri/diam/hex/cyl/h-cyl/lean-l/lean-r/trap-b/trap-t/card } and edges using n1>""asd""] and n1([""asd""]).",,design/2026-01-06_23-44-40-flowchart-shape-support/flowchart-shape-samples.md,"Add a mermaid flowchart block with nodes using @{ shape: rect/text/rounded/tri/diam/hex/cyl/h-cyl/lean-l/lean-r/trap-b/trap-t/card } and edges using n1>""asd""] and n1([""asd""]).\nDONE_CHECK: Sample contains all requested shapes and edge forms.",,,,Not Started,
2026-01-06_23-44-40-flowchart-shape-support,STEP,flowchart-shape-samples,flowchart-shape-samples.03,4,4,3,,test.md - Keep labels simple and unique to avoid parser ambiguity; ensure the mermaid block is valid.,,design/2026-01-06_23-44-40-flowchart-shape-support/flowchart-shape-samples.md,Keep labels simple and unique to avoid parser ambiguity; ensure the mermaid block is valid.\nDONE_CHECK: Mermaid block parses without syntax errors.,,,,Not Started,
2026-01-06_23-44-40-flowchart-shape-support,CHANGE,shape-support-validation,,5,5,,,执行转换回归并核对输出外观与连线表现。,md2visio/vsdx/VDrawerG.cs:368,plan/2026-01-06_23-44-40-flowchart-shape-support.md;design/2026-01-06_23-44-40-flowchart-shape-support/shape-support-validation.md,执行转换回归并核对输出外观与连线表现。 范围：in: test.md / 样例输入; out: 生产代码。验收：Visio 输出包含指定形状，连线与文字正常。,Manual run and visual inspection.\nLog review.,Output contains all target shapes with expected appearance.,,Not Started,
2026-01-06_23-44-40-flowchart-shape-support,STEP,shape-support-validation,shape-support-validation.01,5,5,1,,README.md - Run the standard conversion entrypoint (GUI or CLI) against the updated sample file.,,design/2026-01-06_23-44-40-flowchart-shape-support/shape-support-validation.md,Run the standard conversion entrypoint (GUI or CLI) against the updated sample file.\nDONE_CHECK: Conversion completes and outputs a Visio file.,,,,Not Started,
2026-01-06_23-44-40-flowchart-shape-support,STEP,shape-support-validation,shape-support-validation.02,5,5,2,,"test.md - Inspect the output Visio: tri is upright triangle, h-cyl is horizontal cylinder, text has no fill/line, card uses snipped rectangle.",,design/2026-01-06_23-44-40-flowchart-shape-support/shape-support-validation.md,"Inspect the output Visio: tri is upright triangle, h-cyl is horizontal cylinder, text has no fill/line, card uses snipped rectangle.\nDONE_CHECK: Visual checks pass for each shape.",,,,Not Started,
2026-01-06_23-44-40-flowchart-shape-support,STEP,shape-support-validation,shape-support-validation.03,5,5,3,,"debug.txt - Review debug.txt (or equivalent log) to confirm no ""unknown shape name"" errors.",,design/2026-01-06_23-44-40-flowchart-shape-support/shape-support-validation.md,"Review debug.txt (or equivalent log) to confirm no ""unknown shape name"" errors.\nDONE_CHECK: Log has no shape-related errors.",,,,Not Started,
